<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="comment">%my metropolis hasting algorithm</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T10U3">smpl</span>,<span class="var type1" id="S3T2U4">accept</span>] = myMetropolisHasting(<span class="var type1" id="S4T1U7">start</span>,<span class="var type1" id="S5T2U8">nsamples</span>,<span class="var type1" id="S6T2U9">burnin</span>,<span class="var type1" id="S7T10U10">A</span>,<span class="var type1" id="S8T2U11">C</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line">    <span class="comment">% Put the replicates dimension second.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo" id="T2:U8"><span class="var type1" id="S9T2U14">distnDims</span> = <span class="mxinfo" id="T2:U10">size(<span class="var type1" id="S4T1U17">start</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line">    <span class="mxinfo" id="T10:U12"><span class="var type1" id="S2T10U21">smpl</span> = <span class="mxinfo" id="T10:U14">zeros(<span class="mxinfo" id="T14:U15">[<span class="var type1" id="S5T2U26">nsamples</span>,<span class="var type1" id="S9T2U27">distnDims</span>]</span>,<span class="string">'double'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo" id="T1:U18"><span class="var type1" id="S12T1U31">x0</span> = <span class="var type1" id="S4T1U32">start</span></span>;  <span class="comment">%x0  is the place holder for the current value</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line">    <span class="mxinfo" id="T2:U21"><span class="var type1" id="S3T2U35">accept</span> =<span class="mxinfo" id="T2:U23">0</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line">    <span class="comment">% Metropolis-Hasting Algorithm.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line">    <span class="mxinfo" id="T1:U24"><span class="var type1" id="S13T1U39">U</span> = <span class="mxinfo" id="T1:U26">log(<span class="mxinfo" id="T1:U27">rand(1,<span class="mxinfo" id="T2:U28"><span class="var type1" id="S5T2U46">nsamples</span>+<span class="var type1" id="S6T2U47">burnin</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S16T2U50">i</span> = <span class="mxinfo" id="T9:U32"><span class="mxinfo" id="T2:U33"><span class="mxinfo" id="T2:U34">1</span>-<span class="var type1" id="S6T2U54">burnin</span></span>:<span class="var type1" id="S5T2U55">nsamples</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line">        <span class="mxinfo" id="T9:U37"><span class="var type1" id="S17T9U58">y</span> = <span class="mxinfo" id="T9:U39"><span class="fcn" id="F18N5:B60">proprnd</span>(<span class="mxinfo" id="T9:U40"><span class="var type1" id="S12T1U62">x0</span>'</span>)</span></span>; <span class="comment">% sample from proposal dist'n</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">        <span class="comment">%save the evaluation time for symmetric proposal dist'n</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">        <span class="mxinfo" id="T10:U42"><span class="var type1" id="S19T10U65">rho</span> = <span class="mxinfo" id="T10:U44"><span class="mxinfo" id="T10:U45"><span class="fcn" id="F21N3:B68">logpdf</span>(<span class="mxinfo" id="T1:U46"><span class="var type1" id="S17T9U70">y</span>'</span>,<span class="var type1" id="S7T10U71">A</span>,<span class="var type1" id="S8T2U72">C</span>)</span>-<span class="mxinfo" id="T2:U50"><span class="fcn" id="F68N3:B74">logpdf</span>(<span class="mxinfo" id="T9:U51"><span class="var type1" id="S12T1U76">x0</span>'</span>,<span class="var type1" id="S7T10U77">A</span>,<span class="var type1" id="S8T2U78">C</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">        <span class="comment">% Accept or reject the proposal.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">        <span class="mxinfo" id="T2:U55"><span class="var type1" id="S21T2U81">Ui</span> = <span class="mxinfo" id="T2:U57"><span class="var type1" id="S13T1U83">U</span>(:,<span class="mxinfo" id="T2:U59"><span class="var type1" id="S16T2U86">i</span>+<span class="var type1" id="S6T2U87">burnin</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">        <span class="mxinfo" id="T10:U62"><span class="var type1" id="S22T10U90">acc</span> = <span class="mxinfo" id="T10:U64">(<span class="mxinfo" id="T27:U65"><span class="var type1" id="S21T2U94">Ui</span>&lt;= <span class="mxinfo" id="T10:U67">min(<span class="var type1" id="S19T10U97">rho</span>,0)</span></span>) + <span class="mxinfo" id="T2:U69">0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">        <span class="message error" id="M1F1C"><span class="mxinfo" id="T10:U70"><span class="var type1" id="S12T1U103">x0</span>(<span class="var type1" id="S22T10U104">acc</span>,:)</span> = <span class="mxinfo" id="T9:U73"><span class="var type1" id="S17T9U107">y</span>(<span class="var type1" id="S22T10U108">acc</span>,:)</span></span>; <span class="comment">% preserves x's shape.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">        <span class="mxinfo" id="T2:U76"><span class="var type1" id="S3T2U112">accept</span> = <span class="mxinfo" id="T2:U78"><span class="var type1" id="S3T2U114">accept</span> + <span class="mxinfo" id="T2:U80"><span class="var type1" id="S22T10U116">acc</span>(<span class="mxinfo" id="T2:U82">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T3:U83"><span class="var type1" id="S16T2U121">i</span>&gt;<span class="mxinfo" id="T2:U85">0</span></span> <span class="comment">% burnin</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">            <span class="mxinfo" id="T1:U86"><span class="mxinfo" id="T1:U87"><span class="var type1" id="S2T10U126">smpl</span>(<span class="var type1" id="S16T2U127">i</span>,:)</span> = <span class="var type1" id="S12T1U129">x0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">        <span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">    <span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">    <span class="comment">% Accept rate can be used to optimize the choice of scale parameters in</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">    <span class="comment">% random walk MH sampler. See for example Roberts, Gelman and Gilks (1997).</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">    <span class="mxinfo" id="T2:U91"><span class="var type1" id="S3T2U132">accept</span> = <span class="mxinfo" id="T2:U93"><span class="var type1" id="S3T2U134">accept</span>/(<span class="mxinfo" id="T2:U95"><span class="var type1" id="S5T2U137">nsamples</span>+<span class="var type1" id="S6T2U138">burnin</span></span>)</span></span>;</span></span>
</pre>
